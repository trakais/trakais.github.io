<!DOCTYPE html>
<html>
<head>
	<title>Kurp doties pie dabas Latvijā?</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.css" />
	<script src='http://api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.js'></script>
	<link href='http://api.tiles.mapbox.com/mapbox.js/v1.6.1/mapbox.css' rel='stylesheet' />
	<link rel="stylesheet" type="text/css" href="dodies.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="L.TileLayer.Multi.js"></script>
	<script type='text/javascript' src="http://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxtransport-xdomainrequest/1.0.1/jquery.xdomainrequest.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script src='http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-hash/v0.2.1/leaflet-hash.js'></script>
    <script src='http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-label/v0.2.1/leaflet.label.js'></script>
	<link href='http://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-label/v0.2.1/leaflet.label.css' rel='stylesheet' />
	<script src='csv2geojson.js'></script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48091034-1', 'dodies.lv');
	  ga('send', 'pageview');
	</script>
</head>
<body>
	<img class="logo" src="/img/dodies-alt-s.png" />
	<div id="map"></div>
	<div id='map-ui'>
		<ul>
			<li><a href='#' title="Takas" data-filter="taka"><img alt="takas" border="0" src="m-taka.svg"/></a></li>
			<li><a href='#' title="Torņi" data-filter="tornis"><img  alt="torņi" border="0" src="m-tornis.svg"/></a></li>
			<li><a href='#' title="Piknika vietas" data-filter="pikniks"><img  alt="pikniks" border="0" src="m-pikniks.svg"/></a></li>
			<li><a href='#' title="Parki" data-filter="parks"><img  alt="parki" border="0" src="m-parks.svg"/></a></li>
			<li><a href='#' title="Velo" data-filter="velo"><img  alt="velo" border="0" src="m-velo.svg"/></a></li>
			<li><a href='#' title="Visi" class='active' data-filter="" style="margin-bottom: 10px;"><img alt="visi" border="0" src="m-visi.svg"/></a></li>
			<li><a href='#' id='thelink' title="Par Dodies.lv"><img alt="help" border="0" src="m-help.svg"/></a></li>
			<li><a href="#" title="Kur es esmu?" id="geolocate"><img alt="GPS" border="0" src="m-gps.svg"/></a></li>
		</ul>
	</div>
<script>
	$(document).ready(function () {
	    $('div#thedialog').dialog({
	        autoOpen: false
	    })
	    $('#thelink').click(function () {
	        $('div#thedialog').dialog('open');
	    });
	});

	var iframe = '';

	function myFunc(code, a, b) {
	    txt = '<iframe width="950" height="800" frameborder="0" src="http://www.dodies.lv/#14/' + a + '/' + b + '"></iframe>';
	    iframe = prompt("Kods ievietošanai citā mājaslapā", txt);
	}



	var map = L.mapbox.map('map', { zoomControl:false }).setView([56.9, 24.5], 9);
	L.TileLayer.multi({
	    12: {
	        url: 'http://tiles{s}.api.skobbler.net/tiles/{z}/{x}/{y}.png?api_key=1189b8db552d620e2b1e46fcd2d4edbf',
	        subdomains: '1234',
	        detectRetina: true
	    },
	    17: {
	        url: 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
	    }
	}, {
	    minZoom: 0,
	    maxZoom: 17,
	    detectRetina: true,
	    attribution: 'Tiles Courtesy of OSM — ' + '© OpenStreetMap contributors, ' + 'CC-BY-SA'
	}).addTo(map);


	var hash = new L.Hash(map);
	var markers = [];
	var icons = [];


	function onEachFeature(feature, layer) {
	    markers.push(layer);
	    var popupContent = '<div><b>' + feature.properties.name + '</b><br/>' +
	        '<p>' + feature.properties.desc + '</p>' +
	        '<img class="foto" src="img/' + feature.properties.image + '"/>' +
	        '<div><em style="font-size: 0.7em;"><a href="/#14/' + feature.geometry.coordinates[1] + '/' + feature.geometry.coordinates[0] + '">' + feature.geometry.coordinates[1] + ', ' + feature.geometry.coordinates[0] + '</a></em><div style="float: right; opacity: 0.4; margin-right: 10px;"><!--<a title="maršrutēt" onClick="layMeAPath(' + feature.geometry.coordinates[1] + ',' + feature.geometry.coordinates[0] + ')" href="#"><img src="action-route.png"/></a>&nbsp;--><img class="' + feature.properties.samaksa + '" alt="Samaksa" title="Samaksa" src="action-euro.png"/><a title="ievietot mājaslapā" href="#" onclick="myFunc(\'code\',\'' + feature.geometry.coordinates[1] + '\',\'' + feature.geometry.coordinates[0] + '\');"><img src="action-code.png"/></a></div></div>';
	    layer.bindPopup(popupContent, {
	        maxWidth: 320
	    });
	}

	function filterFeatures(obj) {
	    $('a[data-filter]').each(function () {
	        $(this).removeClass('active');
	    });
	    $(obj).addClass('active');
	    type = $(obj).attr('data-filter');

	    for (var i = 0; i < markers.length; i++) {
	        if (markers[i].feature.properties.tips == type || type == '') {
	            map.addLayer(markers[i]);
	        } else {
	            map.removeLayer(markers[i]);
	        }
	    }
	    return (false);
	}

	$("a[data-filter]").bind("click", function () {
	    filterFeatures(this)
	});
	
$.get("https://dl.dropboxusercontent.com/u/363993/CDN/dati.csv", function (data) {
	    data = csv2geojson.csv2geojson(data);
	    var geojson = L.geoJson([data], {
	        onEachFeature: onEachFeature,
	        pointToLayer: function (feature, latlng) {
	            return L.marker(latlng, {
	                icon: L.divIcon({
	                    className: [feature.properties.statuss],
	                    html: '<img src="m-' + feature.properties.tips + '.svg"/>',
	                    iconSize: [28, 28],
	                    iconAnchor: [12, 24],
	                    popupAnchor: [0, -24],
	                    labelAnchor: [20, 0]
	                })
	            }).bindLabel(feature.properties.name).addTo(map);
	        }
	    });
	    geojson.addTo(map);
	});

	var geolocate = document.getElementById('geolocate');
	if (!navigator.geolocation) {
	    geolocate.innerHTML = 'geolocation is not available';
	} else {
	    geolocate.onclick = function (e) {
	        e.preventDefault();
	        e.stopPropagation();
	        map.locate();
	    };
	}
	map.on('locationfound', function (e) {
	    map.setView([e.latlng.lat, e.latlng.lng], 13);

	    map.markerLayer.setGeoJSON({
	        type: "Feature",
	        geometry: {
	            type: "Point",
	            coordinates: [e.latlng.lng, e.latlng.lat]
	        },
	        properties: {
	            'm-color': '#000',
	            'm-symbol': 'star-stroked'
	        }
	    });
	});
	map.on('locationerror', function () {
	    geolocate.innerHTML = '';
	});
	</script>
	
	<div id="thedialog" style="z-index: 1000;" title="Dodies Latvijā!">
    <p>Šī karte attēlo vietas, kur doties ar ģimeni un bērniem pie dabas. Pārgājienu takas, piknika vietas, skatu torņi un parki. Kartē attēlotas visiem pieejamas bezmaksas vietas, kur brīvdienās doties pastaigāties, ar uzsvaru uz vietām tuvāk dabai.</p>
    <p>Pārsvarā ir iekļautas nekomerciālas vietas, izņemot ja norādīts savādāk. Vietām, kuras esmu apmeklējis pats, ir arī bildes un plašāks apraksts.</p>
    <p>Dati ievākti no dažādiem avotiem: DAP, LVM, pašvaldību mājaslapām. Liela daļa ir pārbaudīta dzīvē.</p>
    <p>Šī karte vienmēr būs bezmaksas, un nesaturēs reklāmas.</p>
    <p><a href="https://dl.dropboxusercontent.com/u/363993/CDN/dati.gpx"><img alt="download gpx" src="download.png" style="float: left; margin-right: 5px; margin-bottom: 3px;"/></a>Visus punktus ir iespējams ielādēt arī GPX formātā, lai ielādētu GPS navigācijas ierīcē. GPX <a href="https://dl.dropboxusercontent.com/u/363993/CDN/dati.gpx">fails atrodas šeit</a></p>
    <p>Kartes, datu, idejas un lapas autors: <a href="http://normis.info">N.R.</a>. Centīgi cilvēki var palīdzēt programmēt iekš <a href="https://github.com/trakais/trakais.github.io">GitHub projekta</a>. </p>
	</div>
</body>
</html>